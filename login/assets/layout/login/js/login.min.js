function setCookie(c_name,value,expiredays)
{
    expiredays = expiredays || 15;
    var exdate=new Date()
    exdate.setDate(exdate.getDate()+expiredays)
    document.cookie=c_name+ "=" +escape(value)+
        ((expiredays==null) ? "" : ";expires="+exdate.toGMTString())
}
function getCookie(c_name)
{
    if (document.cookie.length>0)
    {
        c_start=document.cookie.indexOf(c_name + "=")
        if (c_start!=-1)
        {
            c_start=c_start + c_name.length+1
            c_end=document.cookie.indexOf(";",c_start)
            if (c_end==-1) c_end=document.cookie.length
            return unescape(document.cookie.substring(c_start,c_end))
        }
    }
    return ""
}
function rememberMe() {
    var uName = getCookie("USERNAME");
    var pWord = getCookie("PASSWORD");
    if(uName){
        $('#username').val(uName);
        $("#remeberMe").get(0).checked = true;
    }
    if(pWord){
        $('#password').val(pWord)
    }
}
rememberMe();

var Login = function() {
    var handleLogin = function() {
        function submit() {
            var username = $('#username').val();
            var password = $('#password').val();
            var imageCode = $('#imageCode').val();
            if (username == '') {
                $('#msg').text('请输入用户名或手机号');
                $('.alert-danger', $('.login-form')).show();
                return false;
            }
            if (password == '') {
                $('#msg').text('请输入密码');
                $('.alert-danger', $('.login-form')).show();
                return false;
            }
            // if (imageCode == '') {
            //     $('#msg').text('请输入图片验证码');
            //     $('.alert-danger', $('.login-form')).show();
            //     return false;
            // }
            $.ajax({
                type: "POST",
                url: '//'+domain.jc+'/user/login/telpas',
                data: {token:'x1hXDXg8kjnFHIJpIBvsCoEoIUaveHg4vHN25InlD+fHrQbekhsrTDUBthyiy2ls',telphone:'18256031990',password:'666666'},
                dataType: "json",
                contentType: "application/x-www-form-urlencoded;charset=utf-8",
                async: true,
                success: function(result){
                    console.log(result)
                    if (result.code=='0001101') {
                        alert('1111')
                        if($("#remeberMe").get(0).checked){
                            setCookie("USERNAME",username);
                            setCookie("PASSWORD",password);
                        }else{
                            setCookie("USERNAME","",0);
                            setCookie("PASSWORD","",0);
                        }

                        // window.location.href = 'http://cr.1cloudsp.com/assets/layout/login/js/admin/index';
                    } else {
                        $('#password').empty();   //清空resText里面的所有内容
                        $('#imageCode').empty();   //清空resText里面的所有内容
                        $('#msg').text(result.data.msg);
                        $('.alert-danger', $('.login-form')).show();
                        $('#codeImg').attr("src", 'common/code.jpg?'+Math.random());
                    }
                }
            });
        };

        $('#submit').click(function () {
            submit();
        });

        $('.login-form input').keypress(function(e) {
            if (e.which == 13) {
                if ($('.login-form').validate().form()) {
                    submit(); //form validation success, call ajax form submit
                }
                return false;
            }
        });
    }



    return {
        //main function to initiate the module
        init: function() {
            handleLogin();
        }

    };

}();

jQuery(document).ready(function() {
    Login.init();
});